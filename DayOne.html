<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Day 1: Arithmetic Fluency for CS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fafaf9;
      --surface: #ffffff;
      --surface-alt: #f5f5f4;
      --border: #e7e5e4;
      --border-strong: #d6d3d1;
      --text: #1c1917;
      --text-secondary: #57534e;
      --text-muted: #78716c;
      --accent: #0d9488;
      --accent-light: #ccfbf1;
      --accent-dark: #0f766e;
      --code-bg: #1e1e1e;
      --code-text: #d4d4d4;
      --success: #16a34a;
      --success-bg: #dcfce7;
      --error: #dc2626;
      --error-bg: #fee2e2;
      --warning: #d97706;
      --warning-bg: #fef3c7;
      --purple: #7c3aed;
      --purple-light: #ede9fe;
      --blue: #2563eb;
      --blue-light: #dbeafe;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
      --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.05);
      --radius: 8px;
      --radius-lg: 12px;
      --font-serif: 'Source Serif 4', Georgia, serif;
      --font-sans: 'DM Sans', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html { scroll-behavior: smooth; }

    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
    }

    /* Navigation */
    .nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(250, 250, 249, 0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 12px 24px;
    }

    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .nav-back {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: var(--radius);
      transition: all 0.15s;
    }

    .nav-back:hover {
      background: var(--surface-alt);
      color: var(--text);
    }

    .nav-progress {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .progress-bar {
      width: 120px;
      height: 6px;
      background: var(--border);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.3s ease;
    }

    /* Hero */
    .hero {
      max-width: 1200px;
      margin: 0 auto;
      padding: 48px 24px 32px;
    }

    .hero-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--accent-dark);
      background: var(--accent-light);
      padding: 6px 12px;
      border-radius: 999px;
      margin-bottom: 16px;
    }

    .hero h1 {
      font-family: var(--font-serif);
      font-size: clamp(32px, 5vw, 48px);
      font-weight: 700;
      line-height: 1.2;
      letter-spacing: -0.02em;
      margin-bottom: 16px;
    }

    .hero-desc {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 720px;
      line-height: 1.6;
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .meta-icon {
      width: 18px;
      height: 18px;
      color: var(--text-muted);
    }

    /* Main Layout */
    .main-layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px 80px;
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 48px;
    }

    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: 1fr;
        gap: 32px;
      }
      .sidebar { display: none; }
    }

    /* Sidebar */
    .sidebar {
      position: sticky;
      top: 80px;
      align-self: start;
      max-height: calc(100vh - 100px);
      overflow-y: auto;
    }

    .toc {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 16px;
    }

    .toc-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .toc-list {
      list-style: none;
    }

    .toc-link {
      display: block;
      padding: 8px 12px;
      font-size: 14px;
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: var(--radius);
      border-left: 2px solid transparent;
      margin-left: -2px;
      transition: all 0.15s;
    }

    .toc-link:hover {
      color: var(--text);
      background: var(--surface-alt);
    }

    .toc-link.active {
      color: var(--accent-dark);
      background: var(--accent-light);
      border-left-color: var(--accent);
    }

    /* Stats Card */
    .stats-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-top: 16px;
    }

    .stats-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      font-size: 13px;
    }

    .stats-label {
      color: var(--text-muted);
    }

    .stats-value {
      font-weight: 600;
      font-family: var(--font-mono);
      color: var(--text);
    }

    /* Content */
    .content {
      min-width: 0;
    }

    /* Section */
    .section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      margin-bottom: 24px;
      overflow: hidden;
    }

    .section-header {
      padding: 24px 28px 20px;
      border-bottom: 1px solid var(--border);
    }

    .section-number {
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .section-title {
      font-family: var(--font-serif);
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .section-body {
      padding: 24px 28px;
    }

    /* Subsection */
    .subsection {
      margin-bottom: 32px;
    }

    .subsection:last-child {
      margin-bottom: 0;
    }

    .subsection-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .subsection-title::before {
      content: '';
      width: 4px;
      height: 4px;
      background: var(--accent);
      border-radius: 50%;
    }

    p {
      margin-bottom: 12px;
      color: var(--text-secondary);
    }

    /* Math Display */
    .math-block {
      background: var(--surface-alt);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px 20px;
      margin: 16px 0;
      font-family: var(--font-mono);
      font-size: 15px;
      color: var(--text);
      overflow-x: auto;
    }

    .math-inline {
      font-family: var(--font-mono);
      font-size: 14px;
      background: var(--surface-alt);
      padding: 2px 6px;
      border-radius: 4px;
      color: var(--text);
    }

    /* Rule/Callout */
    .rule {
      background: var(--accent-light);
      border-left: 3px solid var(--accent);
      border-radius: 0 var(--radius) var(--radius) 0;
      padding: 16px 20px;
      margin: 16px 0;
      color: var(--accent-dark);
      font-weight: 500;
    }

    .warning {
      background: var(--warning-bg);
      border-left: 3px solid var(--warning);
      border-radius: 0 var(--radius) var(--radius) 0;
      padding: 16px 20px;
      margin: 16px 0;
      color: #92400e;
    }

    .warning strong {
      color: #78350f;
    }

    /* Code Block */
    .code-block {
      background: var(--code-bg);
      border-radius: var(--radius);
      margin: 16px 0;
      overflow: hidden;
    }

    .code-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      background: #2d2d2d;
      border-bottom: 1px solid #3d3d3d;
    }

    .code-lang {
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 600;
      color: #a1a1aa;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .code-label {
      font-size: 12px;
      color: #71717a;
    }

    .code-content {
      padding: 16px 20px;
      overflow-x: auto;
    }

    .code-content pre {
      margin: 0;
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.6;
      color: var(--code-text);
    }

    /* Syntax highlighting */
    .code-keyword { color: #c586c0; }
    .code-function { color: #dcdcaa; }
    .code-string { color: #ce9178; }
    .code-number { color: #b5cea8; }
    .code-comment { color: #6a9955; }
    .code-operator { color: #d4d4d4; }
    .code-type { color: #4ec9b0; }

    /* List */
    ul {
      margin: 12px 0 12px 24px;
      color: var(--text-secondary);
    }

    li {
      margin-bottom: 8px;
    }

    li strong {
      color: var(--text);
    }

    /* Two Column Grid */
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 16px 0;
    }

    @media (max-width: 600px) {
      .two-col { grid-template-columns: 1fr; }
    }

    /* Video Section */
    .video-container {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 20px;
      margin-top: 16px;
    }

    @media (max-width: 800px) {
      .video-container { grid-template-columns: 1fr; }
    }

    .video-player {
      background: var(--code-bg);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .video-player iframe {
      width: 100%;
      aspect-ratio: 16/9;
      display: block;
      border: 0;
    }

    .video-info {
      padding: 16px;
      border-top: 1px solid #3d3d3d;
    }

    .video-title {
      font-weight: 600;
      color: #fff;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .video-meta {
      font-size: 13px;
      color: #a1a1aa;
    }

    .video-list {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      max-height: 480px;
      overflow-y: auto;
    }

    .video-group-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      padding: 16px 16px 8px;
      background: var(--surface-alt);
      position: sticky;
      top: 0;
    }

    .video-item {
      display: flex;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
      transition: background 0.15s;
    }

    .video-item:hover {
      background: var(--surface-alt);
    }

    .video-item.active {
      background: var(--accent-light);
    }

    .video-num {
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--accent);
      font-weight: 600;
      min-width: 24px;
    }

    .video-item-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      line-height: 1.4;
    }

    .video-item-desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    /* Quiz Section */
    .quiz-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 600;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn:hover {
      background: var(--surface-alt);
      border-color: var(--border-strong);
    }

    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--accent-dark);
      border-color: var(--accent-dark);
    }

    .btn-danger {
      color: var(--error);
      border-color: var(--error);
    }

    .btn-danger:hover {
      background: var(--error-bg);
    }

    /* Question Card */
    .question {
      background: var(--surface-alt);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 20px;
      margin-bottom: 16px;
    }

    .question-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .question-num {
      font-family: var(--font-mono);
      font-size: 13px;
      font-weight: 700;
      color: var(--accent);
    }

    .question-topic {
      font-size: 12px;
      color: var(--text-muted);
      background: var(--surface);
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
    }

    .question-prompt {
      font-family: var(--font-mono);
      font-size: 16px;
      font-weight: 500;
      color: var(--text);
      background: var(--surface);
      padding: 16px 20px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      margin-bottom: 16px;
    }

    .question-input-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .question-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      font-family: var(--font-mono);
      font-size: 15px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      background: var(--surface);
      color: var(--text);
      outline: none;
      transition: border-color 0.15s;
    }

    .question-input:focus {
      border-color: var(--accent);
    }

    .question-input.correct {
      border-color: var(--success);
      background: var(--success-bg);
    }

    .question-input.incorrect {
      border-color: var(--error);
      background: var(--error-bg);
    }

    .question-result {
      margin-top: 12px;
      font-size: 14px;
      font-weight: 500;
    }

    .question-result.success {
      color: var(--success);
    }

    .question-result.error {
      color: var(--error);
    }

    .question-answer {
      margin-top: 8px;
      font-family: var(--font-mono);
      font-size: 13px;
      color: var(--accent-dark);
      background: var(--accent-light);
      padding: 8px 12px;
      border-radius: var(--radius);
      display: inline-block;
    }

    /* Divider */
    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 24px 0;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .hero { padding: 32px 16px 24px; }
      .main-layout { padding: 0 16px 60px; }
      .section-header, .section-body { padding: 20px; }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-back">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10 12L6 8L10 4"/>
        </svg>
        Back to Curriculum
      </a>
      <div class="nav-progress">
        <span id="progressText">0 / 20 complete</span>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>
    </div>
  </nav>

  <header class="hero">
    <div class="hero-label">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M8 0L10 6H16L11 9.5L13 16L8 12L3 16L5 9.5L0 6H6L8 0Z"/>
      </svg>
      Day 1 · Foundation
    </div>
    <h1>Arithmetic Fluency for Computer Science</h1>
    <p class="hero-desc">
      Master the numerical operations that underpin algorithms, graphics, cryptography, and machine learning. 
      This isn't just math review—it's building the mental reflexes you'll use every day as a developer.
    </p>
    <div class="hero-meta">
      <div class="meta-item">
        <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
        </svg>
        ~45 min read
      </div>
      <div class="meta-item">
        <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
        </svg>
        20 practice problems
      </div>
      <div class="meta-item">
        <svg class="meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="5 3 19 12 5 21 5 3"/>
        </svg>
        12 video lessons
      </div>
    </div>
  </header>

  <div class="main-layout">
    <aside class="sidebar">
      <nav class="toc">
        <div class="toc-title">On this page</div>
        <ul class="toc-list">
          <li><a href="#why" class="toc-link">Why This Matters</a></li>
          <li><a href="#fractions" class="toc-link">1. Fractions</a></li>
          <li><a href="#negatives" class="toc-link">2. Negatives</a></li>
          <li><a href="#exponents" class="toc-link">3. Exponents & Roots</a></li>
          <li><a href="#scientific" class="toc-link">4. Scientific Notation</a></li>
          <li><a href="#gotchas" class="toc-link">5. Common Gotchas</a></li>
          <li><a href="#videos" class="toc-link">6. Video Lessons</a></li>
          <li><a href="#practice" class="toc-link">7. Practice Problems</a></li>
        </ul>
      </nav>

      <div class="stats-card">
        <div class="toc-title">Your Progress</div>
        <div class="stats-row">
          <span class="stats-label">Attempted</span>
          <span class="stats-value" id="statAttempted">0</span>
        </div>
        <div class="stats-row">
          <span class="stats-label">Correct</span>
          <span class="stats-value" id="statCorrect">0</span>
        </div>
        <div class="stats-row">
          <span class="stats-label">Accuracy</span>
          <span class="stats-value" id="statAccuracy">—</span>
        </div>
      </div>
    </aside>

    <main class="content">
      <!-- Why This Matters -->
      <section class="section" id="why">
        <div class="section-header">
          <div class="section-number">Section 0</div>
          <h2 class="section-title">Why Arithmetic Fluency Matters in CS</h2>
        </div>
        <div class="section-body">
          <p>
            Every algorithm you write manipulates numbers. Graphics shaders blend colors using fractions. 
            Cryptographic systems rely on modular exponentiation. Machine learning is just matrix 
            multiplication at scale. If you hesitate on basic operations, you'll struggle with the real stuff.
          </p>

          <div class="rule">
            <strong>The goal:</strong> These operations should be reflexive. When you see <span class="math-inline">3/4 + 5/6</span>, 
            your brain should pattern-match to "common denominator" without conscious thought.
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Where you'll use this</h3>
            <ul>
              <li><strong>Graphics/Games:</strong> Color blending, interpolation, physics simulation</li>
              <li><strong>Cryptography:</strong> RSA uses exponents mod n, key sizes are powers of 2</li>
              <li><strong>ML/Data Science:</strong> Normalization, gradients, floating-point precision</li>
              <li><strong>Systems:</strong> Memory alignment, bit manipulation, overflow detection</li>
            </ul>
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-lang">Python</span>
              <span class="code-label">Color blending uses fractions constantly</span>
            </div>
            <div class="code-content">
<pre><span class="code-comment"># Blend two colors: result = color1 * (1-t) + color2 * t</span>
<span class="code-keyword">def</span> <span class="code-function">lerp_color</span>(c1, c2, t):
    <span class="code-comment"># t=0 → c1, t=1 → c2, t=0.5 → halfway</span>
    <span class="code-keyword">return</span> tuple(
        <span class="code-function">int</span>(c1[i] * (<span class="code-number">1</span> - t) + c2[i] * t)
        <span class="code-keyword">for</span> i <span class="code-keyword">in</span> <span class="code-function">range</span>(<span class="code-number">3</span>)
    )

<span class="code-comment"># What's 3/4 of the way from red to blue?</span>
red = (<span class="code-number">255</span>, <span class="code-number">0</span>, <span class="code-number">0</span>)
blue = (<span class="code-number">0</span>, <span class="code-number">0</span>, <span class="code-number">255</span>)
result = <span class="code-function">lerp_color</span>(red, blue, <span class="code-number">0.75</span>)  <span class="code-comment"># (63, 0, 191)</span></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- Fractions -->
      <section class="section" id="fractions">
        <div class="section-header">
          <div class="section-number">Section 1</div>
          <h2 class="section-title">Fractions</h2>
        </div>
        <div class="section-body">
          <div class="subsection">
            <h3 class="subsection-title">Core definition</h3>
            <div class="math-block">a/b means a ÷ b &nbsp;&nbsp;(where b ≠ 0)</div>
            <p>
              A fraction is just delayed division. This matters in programming because integer division 
              truncates: <span class="math-inline">7 // 2 = 3</span> in Python, not 3.5.
            </p>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Equivalent fractions</h3>
            <div class="math-block">a/b = (a·k) / (b·k) &nbsp;&nbsp;for any k ≠ 0</div>
            <p>
              Multiplying top and bottom by the same number doesn't change the value. 
              This is how we find common denominators.
            </p>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Simplifying (reducing)</h3>
            <div class="rule">
              Divide numerator and denominator by their GCD (greatest common divisor).
            </div>
            <div class="math-block">24/36 = (24 ÷ 12) / (36 ÷ 12) = 2/3</div>
            
            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">GCD is the foundation of fraction simplification</span>
              </div>
              <div class="code-content">
<pre><span class="code-keyword">import</span> math

<span class="code-keyword">def</span> <span class="code-function">simplify</span>(num, den):
    <span class="code-string">"""Reduce a fraction to lowest terms."""</span>
    g = math.<span class="code-function">gcd</span>(num, den)
    <span class="code-keyword">return</span> num // g, den // g

<span class="code-function">simplify</span>(<span class="code-number">24</span>, <span class="code-number">36</span>)  <span class="code-comment"># → (2, 3)</span>
<span class="code-function">simplify</span>(<span class="code-number">100</span>, <span class="code-number">75</span>) <span class="code-comment"># → (4, 3)</span></pre>
              </div>
            </div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Adding & subtracting fractions</h3>
            <div class="rule">
              You must have the same denominator. Find the LCD (least common denominator), 
              convert both fractions, then add/subtract the numerators.
            </div>
            <div class="math-block">a/b + c/d = (a·d + c·b) / (b·d)</div>
            <p>Example: <span class="math-inline">2/3 + 1/6 = 4/6 + 1/6 = 5/6</span></p>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">Fraction addition in code</span>
              </div>
              <div class="code-content">
<pre><span class="code-keyword">from</span> fractions <span class="code-keyword">import</span> Fraction

<span class="code-comment"># Python's Fraction class handles this automatically</span>
a = Fraction(<span class="code-number">2</span>, <span class="code-number">3</span>)
b = Fraction(<span class="code-number">1</span>, <span class="code-number">6</span>)
<span class="code-function">print</span>(a + b)  <span class="code-comment"># → 5/6 (auto-simplified)</span>

<span class="code-comment"># Manual implementation</span>
<span class="code-keyword">def</span> <span class="code-function">add_fractions</span>(n1, d1, n2, d2):
    num = n1 * d2 + n2 * d1
    den = d1 * d2
    <span class="code-keyword">return</span> <span class="code-function">simplify</span>(num, den)

<span class="code-function">add_fractions</span>(<span class="code-number">2</span>, <span class="code-number">3</span>, <span class="code-number">1</span>, <span class="code-number">6</span>)  <span class="code-comment"># → (5, 6)</span></pre>
              </div>
            </div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Multiplying fractions</h3>
            <div class="math-block">(a/b) · (c/d) = (a·c) / (b·d)</div>
            <p>
              Just multiply straight across. Pro tip: cancel common factors <em>before</em> multiplying 
              to keep numbers small.
            </p>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Dividing fractions</h3>
            <div class="rule">
              Dividing by a fraction = multiplying by its reciprocal (flip it).
            </div>
            <div class="math-block">(a/b) ÷ (c/d) = (a/b) · (d/c) = (a·d) / (b·c)</div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Mixed numbers</h3>
            <div class="math-block">m p/q = (m·q + p) / q</div>
            <p>Example: <span class="math-inline">2 3/5 = (2·5 + 3) / 5 = 13/5</span></p>
            <p>
              Convert mixed numbers to improper fractions before doing any operations. 
              Convert back at the end if needed.
            </p>
          </div>
        </div>
      </section>

      <!-- Negatives -->
      <section class="section" id="negatives">
        <div class="section-header">
          <div class="section-number">Section 2</div>
          <h2 class="section-title">Negatives (Signed Numbers)</h2>
        </div>
        <div class="section-body">
          <div class="subsection">
            <h3 class="subsection-title">Subtraction is addition of the opposite</h3>
            <div class="math-block">a − b = a + (−b)</div>
            <p>
              This reframing eliminates a whole class of errors. There's no "subtraction rule" anymore—just addition.
            </p>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Adding signed numbers</h3>
            <ul>
              <li><strong>Same signs:</strong> Add magnitudes, keep the sign → <span class="math-inline">(−7) + (−5) = −12</span></li>
              <li><strong>Different signs:</strong> Subtract magnitudes, keep sign of larger magnitude → <span class="math-inline">(−9) + 4 = −5</span></li>
            </ul>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Subtracting a negative</h3>
            <div class="rule">
              Subtracting a negative flips to addition: <span class="math-inline">a − (−b) = a + b</span>
            </div>
            <p>Example: <span class="math-inline">5 − (−3) = 5 + 3 = 8</span></p>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Multiplying & dividing signs</h3>
            <div class="math-block">
(+) × (+) = (+) &nbsp;&nbsp;&nbsp;&nbsp; (−) × (−) = (+)
(+) × (−) = (−) &nbsp;&nbsp;&nbsp;&nbsp; (−) × (+) = (−)
            </div>
            <div class="rule">Same signs → positive. Different signs → negative.</div>
            <p>This applies to division too.</p>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">JavaScript</span>
                <span class="code-label">Sign handling in coordinate systems</span>
              </div>
              <div class="code-content">
<pre><span class="code-comment">// In screen coordinates, Y increases downward</span>
<span class="code-comment">// In math coordinates, Y increases upward</span>
<span class="code-comment">// Conversion requires sign flipping</span>

<span class="code-keyword">function</span> <span class="code-function">screenToMath</span>(screenY, canvasHeight) {
  <span class="code-comment">// Flip Y axis: subtract from height</span>
  <span class="code-keyword">return</span> canvasHeight - screenY;
}

<span class="code-keyword">function</span> <span class="code-function">mathToScreen</span>(mathY, canvasHeight) {
  <span class="code-keyword">return</span> canvasHeight - mathY;  <span class="code-comment">// Same operation!</span>
}

<span class="code-comment">// Velocity with direction</span>
<span class="code-keyword">let</span> velocityY = -<span class="code-number">5</span>;  <span class="code-comment">// Moving up (negative in screen coords)</span>
<span class="code-keyword">let</span> gravity = <span class="code-number">0.5</span>;   <span class="code-comment">// Pulling down (positive)</span>

velocityY += gravity; <span class="code-comment">// -5 + 0.5 = -4.5 (still moving up, but slower)</span></pre>
              </div>
            </div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">The classic trap: negatives and exponents</h3>
            <div class="warning">
              <strong>Watch out:</strong> 
              <span class="math-inline">−3² = −(3²) = −9</span> but <span class="math-inline">(−3)² = 9</span>
              <br><br>
              Without parentheses, the exponent binds tighter than the negative sign.
            </div>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">Python follows standard math precedence</span>
              </div>
              <div class="code-content">
<pre><span class="code-comment"># The negation happens AFTER the exponentiation</span>
<span class="code-function">print</span>(-<span class="code-number">3</span> ** <span class="code-number">2</span>)    <span class="code-comment"># → -9  (this is -(3²))</span>
<span class="code-function">print</span>((-<span class="code-number">3</span>) ** <span class="code-number">2</span>)  <span class="code-comment"># → 9   (this is (−3)²)</span>

<span class="code-comment"># This bites people ALL THE TIME</span>
x = -<span class="code-number">2</span>
wrong = -x ** <span class="code-number">2</span>   <span class="code-comment"># -4, not what you probably wanted</span>
right = (-x) ** <span class="code-number">2</span> <span class="code-comment"># 4</span>
also_right = x ** <span class="code-number">2</span>  <span class="code-comment"># 4, because (−2)² = 4</span></pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Exponents & Roots -->
      <section class="section" id="exponents">
        <div class="section-header">
          <div class="section-number">Section 3</div>
          <h2 class="section-title">Exponents & Roots</h2>
        </div>
        <div class="section-body">
          <div class="subsection">
            <h3 class="subsection-title">Core definition</h3>
            <div class="math-block">aⁿ = a × a × ... × a &nbsp;&nbsp;(n times)</div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">The seven exponent laws (memorize these)</h3>
            <div class="two-col">
              <div class="math-block">
aᵐ · aⁿ = aᵐ⁺ⁿ
<span style="color:var(--text-muted);font-size:13px;">// same base → add exponents</span>
              </div>
              <div class="math-block">
aᵐ / aⁿ = aᵐ⁻ⁿ
<span style="color:var(--text-muted);font-size:13px;">// same base → subtract exponents</span>
              </div>
            </div>
            <div class="two-col">
              <div class="math-block">
(aᵐ)ⁿ = aᵐⁿ
<span style="color:var(--text-muted);font-size:13px;">// power of power → multiply</span>
              </div>
              <div class="math-block">
(ab)ⁿ = aⁿbⁿ
<span style="color:var(--text-muted);font-size:13px;">// distribute over multiplication</span>
              </div>
            </div>
            <div class="two-col">
              <div class="math-block">
(a/b)ⁿ = aⁿ / bⁿ
<span style="color:var(--text-muted);font-size:13px;">// distribute over division</span>
              </div>
              <div class="math-block">
a⁰ = 1 &nbsp;&nbsp;(a ≠ 0)
<span style="color:var(--text-muted);font-size:13px;">// any nonzero number to 0 is 1</span>
              </div>
            </div>
            <div class="math-block">
a⁻ⁿ = 1 / aⁿ
<span style="color:var(--text-muted);font-size:13px;">// negative exponent → reciprocal</span>
            </div>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">Exponent laws in action: big-O simplification</span>
              </div>
              <div class="code-content">
<pre><span class="code-comment"># When analyzing algorithms, we use these constantly</span>

<span class="code-comment"># O(n²) · O(n) = O(n³)  → exponents add</span>
<span class="code-comment"># O(n³) / O(n) = O(n²)  → exponents subtract</span>

<span class="code-comment"># Example: nested loops</span>
<span class="code-keyword">def</span> <span class="code-function">example</span>(n):
    count = <span class="code-number">0</span>
    <span class="code-keyword">for</span> i <span class="code-keyword">in</span> <span class="code-function">range</span>(n):       <span class="code-comment"># O(n)</span>
        <span class="code-keyword">for</span> j <span class="code-keyword">in</span> <span class="code-function">range</span>(n):   <span class="code-comment"># × O(n)</span>
            <span class="code-keyword">for</span> k <span class="code-keyword">in</span> <span class="code-function">range</span>(n): <span class="code-comment"># × O(n)</span>
                count += <span class="code-number">1</span>
    <span class="code-keyword">return</span> count  <span class="code-comment"># Total: O(n³) = O(n¹⁺¹⁺¹)</span></pre>
              </div>
            </div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Fractional exponents (roots)</h3>
            <div class="math-block">
a^(1/n) = ⁿ√a &nbsp;&nbsp;&nbsp;&nbsp; (nth root of a)
a^(m/n) = ⁿ√(aᵐ) = (ⁿ√a)ᵐ
            </div>
            <p>
              A fractional exponent combines a power and a root. The denominator is the root, 
              the numerator is the power. Order doesn't matter mathematically, but computationally 
              take the root first to keep numbers smaller.
            </p>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">Roots as fractional exponents</span>
              </div>
              <div class="code-content">
<pre><span class="code-comment"># Square root = power of 1/2</span>
<span class="code-function">print</span>(<span class="code-number">16</span> ** <span class="code-number">0.5</span>)    <span class="code-comment"># → 4.0</span>
<span class="code-function">print</span>(<span class="code-number">16</span> ** (<span class="code-number">1</span>/<span class="code-number">2</span>))  <span class="code-comment"># → 4.0</span>

<span class="code-comment"># Cube root = power of 1/3</span>
<span class="code-function">print</span>(<span class="code-number">27</span> ** (<span class="code-number">1</span>/<span class="code-number">3</span>))  <span class="code-comment"># → 3.0</span>

<span class="code-comment"># 16^(3/4) = fourth root of 16, then cubed</span>
<span class="code-function">print</span>(<span class="code-number">16</span> ** (<span class="code-number">3</span>/<span class="code-number">4</span>))  <span class="code-comment"># → 8.0 (because ⁴√16 = 2, and 2³ = 8)</span>

<span class="code-comment"># Useful in graphics: gamma correction</span>
<span class="code-keyword">def</span> <span class="code-function">gamma_correct</span>(color, gamma=<span class="code-number">2.2</span>):
    <span class="code-string">"""Convert linear color to sRGB (gamma = 1/2.2 ≈ 0.45)"""</span>
    <span class="code-keyword">return</span> color ** (<span class="code-number">1</span> / gamma)</pre>
              </div>
            </div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Even vs odd roots of negatives</h3>
            <ul>
              <li><strong>Even roots of negatives are not real:</strong> <span class="math-inline">√(−9)</span> is imaginary</li>
              <li><strong>Odd roots of negatives are real:</strong> <span class="math-inline">∛(−8) = −2</span></li>
            </ul>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">Handling negative roots</span>
              </div>
              <div class="code-content">
<pre><span class="code-keyword">import</span> math, cmath

<span class="code-comment"># Even root of negative → error (or nan)</span>
<span class="code-comment"># math.sqrt(-9)  # ValueError!</span>

<span class="code-comment"># Use complex math for imaginary results</span>
<span class="code-function">print</span>(cmath.<span class="code-function">sqrt</span>(-<span class="code-number">9</span>))  <span class="code-comment"># → 3j (i.e., 3i)</span>

<span class="code-comment"># Cube root of negative is real, but Python's ** is weird:</span>
<span class="code-function">print</span>((-<span class="code-number">8</span>) ** (<span class="code-number">1</span>/<span class="code-number">3</span>))  <span class="code-comment"># → (1.0+1.732j) — gives complex!</span>

<span class="code-comment"># For real cube roots of negatives, preserve the sign:</span>
<span class="code-keyword">def</span> <span class="code-function">cbrt</span>(x):
    <span class="code-string">"""Real cube root that handles negatives correctly."""</span>
    <span class="code-keyword">if</span> x >= <span class="code-number">0</span>:
        <span class="code-keyword">return</span> x ** (<span class="code-number">1</span>/<span class="code-number">3</span>)
    <span class="code-keyword">else</span>:
        <span class="code-keyword">return</span> -(<span class="code-function">abs</span>(x) ** (<span class="code-number">1</span>/<span class="code-number">3</span>))

<span class="code-function">print</span>(<span class="code-function">cbrt</span>(-<span class="code-number">8</span>))  <span class="code-comment"># → -2.0 ✓</span></pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Scientific Notation -->
      <section class="section" id="scientific">
        <div class="section-header">
          <div class="section-number">Section 4</div>
          <h2 class="section-title">Scientific Notation</h2>
        </div>
        <div class="section-body">
          <div class="subsection">
            <h3 class="subsection-title">Standard form</h3>
            <div class="math-block">a × 10ⁿ &nbsp;&nbsp;where 1 ≤ |a| < 10 and n is an integer</div>
            <p>
              Scientific notation is how computers represent floating-point numbers internally. 
              Understanding it helps you reason about precision and overflow.
            </p>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Converting to/from</h3>
            <ul>
              <li><strong>Move decimal left → positive exponent:</strong> 12,300 = 1.23 × 10⁴</li>
              <li><strong>Move decimal right → negative exponent:</strong> 0.0051 = 5.1 × 10⁻³</li>
            </ul>
            <p>
              Count the places you move. The exponent tells you "how many times to multiply/divide by 10".
            </p>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">Scientific notation in code</span>
              </div>
              <div class="code-content">
<pre><span class="code-comment"># Python uses 'e' notation for scientific numbers</span>
avogadro = <span class="code-number">6.022e23</span>    <span class="code-comment"># 6.022 × 10²³</span>
planck = <span class="code-number">6.626e-34</span>     <span class="code-comment"># 6.626 × 10⁻³⁴</span>

<span class="code-comment"># Formatting numbers in scientific notation</span>
big = <span class="code-number">123456789</span>
<span class="code-function">print</span>(<span class="code-string">f"</span>{big:<span class="code-number">.2e</span>}<span class="code-string">"</span>)  <span class="code-comment"># → 1.23e+08</span>

small = <span class="code-number">0.00000456</span>
<span class="code-function">print</span>(<span class="code-string">f"</span>{small:<span class="code-number">.2e</span>}<span class="code-string">"</span>)  <span class="code-comment"># → 4.56e-06</span>

<span class="code-comment"># Understanding floating point limits</span>
<span class="code-keyword">import</span> sys
<span class="code-function">print</span>(sys.float_info.max)  <span class="code-comment"># ~1.8e+308 (largest float)</span>
<span class="code-function">print</span>(sys.float_info.min)  <span class="code-comment"># ~2.2e-308 (smallest positive)</span></pre>
              </div>
            </div>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Multiplying & dividing</h3>
            <div class="math-block">
(a × 10ᵐ) × (b × 10ⁿ) = (a × b) × 10ᵐ⁺ⁿ
(a × 10ᵐ) ÷ (b × 10ⁿ) = (a ÷ b) × 10ᵐ⁻ⁿ
            </div>
            <p>
              Multiply/divide the coefficients, add/subtract the exponents. This is exactly how 
              floating-point multiplication works in hardware.
            </p>
          </div>

          <div class="subsection">
            <h3 class="subsection-title">Adding & subtracting</h3>
            <div class="rule">
              You must align the exponents first. Convert to the same power of 10, then add/subtract 
              the coefficients.
            </div>
            <div class="math-block">
3.2 × 10⁵ + 4.5 × 10⁴
= 3.2 × 10⁵ + 0.45 × 10⁵
= 3.65 × 10⁵
            </div>

            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Python</span>
                <span class="code-label">Why floating-point addition can lose precision</span>
              </div>
              <div class="code-content">
<pre><span class="code-comment"># Adding numbers with very different magnitudes</span>
big = <span class="code-number">1e16</span>
small = <span class="code-number">1.0</span>

<span class="code-function">print</span>(big + small == big)  <span class="code-comment"># → True! The 1.0 was lost</span>

<span class="code-comment"># Why? In binary scientific notation, 1e16 looks like:</span>
<span class="code-comment"># 1.0 × 2^53 (roughly)</span>
<span class="code-comment"># Adding 1.0 means aligning to same exponent:</span>
<span class="code-comment"># 1.0 × 2^53 + 0.0000000000000001 × 2^53</span>
<span class="code-comment"># The small coefficient rounds to 0!</span>

<span class="code-comment"># This is called "catastrophic cancellation"</span>
<span class="code-comment"># Solution: use libraries like Decimal for precision</span>
<span class="code-keyword">from</span> decimal <span class="code-keyword">import</span> Decimal
big_d = Decimal(<span class="code-string">'1e16'</span>)
small_d = Decimal(<span class="code-string">'1'</span>)
<span class="code-function">print</span>(big_d + small_d)  <span class="code-comment"># → 10000000000000001 ✓</span></pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Gotchas -->
      <section class="section" id="gotchas">
        <div class="section-header">
          <div class="section-number">Section 5</div>
          <h2 class="section-title">Common Gotchas</h2>
        </div>
        <div class="section-body">
          <p>These are the mistakes that trip up even experienced developers. Burn these into memory.</p>

          <div class="warning" style="margin-top: 16px;">
            <strong>1. Exponent + negative sign</strong><br>
            <span class="math-inline">-3² = -9</span> but <span class="math-inline">(-3)² = 9</span><br>
            The exponent binds before the negation.
          </div>

          <div class="warning">
            <strong>2. Subtracting a negative</strong><br>
            <span class="math-inline">a - (-b) = a + b</span><br>
            Two negatives make a positive.
          </div>

          <div class="warning">
            <strong>3. Adding fractions wrong</strong><br>
            <span class="math-inline">1/2 + 1/3 ≠ 2/5</span> (wrong!)<br>
            <span class="math-inline">1/2 + 1/3 = 3/6 + 2/6 = 5/6</span> ✓<br>
            You cannot add numerators if denominators differ.
          </div>

          <div class="warning">
            <strong>4. Negative exponents</strong><br>
            <span class="math-inline">2⁻³ = 1/2³ = 1/8</span>, not <span class="math-inline">-8</span><br>
            A negative exponent means "reciprocal", not "negative result".
          </div>

          <div class="warning">
            <strong>5. Scientific notation addition</strong><br>
            You must match exponents first. Don't just add coefficients.
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-lang">Python</span>
              <span class="code-label">All gotchas in one place</span>
            </div>
            <div class="code-content">
<pre><span class="code-comment"># Gotcha 1: Negation vs exponentiation</span>
<span class="code-keyword">assert</span> -<span class="code-number">3</span>**<span class="code-number">2</span> == -<span class="code-number">9</span>
<span class="code-keyword">assert</span> (-<span class="code-number">3</span>)**<span class="code-number">2</span> == <span class="code-number">9</span>

<span class="code-comment"># Gotcha 2: Double negative</span>
<span class="code-keyword">assert</span> <span class="code-number">5</span> - (-<span class="code-number">3</span>) == <span class="code-number">8</span>

<span class="code-comment"># Gotcha 3: Fraction addition (use Fraction class!)</span>
<span class="code-keyword">from</span> fractions <span class="code-keyword">import</span> Fraction
<span class="code-keyword">assert</span> Fraction(<span class="code-number">1</span>,<span class="code-number">2</span>) + Fraction(<span class="code-number">1</span>,<span class="code-number">3</span>) == Fraction(<span class="code-number">5</span>,<span class="code-number">6</span>)

<span class="code-comment"># Gotcha 4: Negative exponent = reciprocal</span>
<span class="code-keyword">assert</span> <span class="code-number">2</span>**-<span class="code-number">3</span> == <span class="code-number">0.125</span>  <span class="code-comment"># = 1/8</span>
<span class="code-keyword">assert</span> <span class="code-number">2</span>**-<span class="code-number">3</span> == <span class="code-number">1</span> / <span class="code-number">2</span>**<span class="code-number">3</span>

<span class="code-comment"># Gotcha 5: Scientific notation precision</span>
<span class="code-comment"># 3.2e5 + 4.5e4 → align first!</span>
<span class="code-keyword">assert</span> <span class="code-function">abs</span>((<span class="code-number">3.2e5</span> + <span class="code-number">4.5e4</span>) - <span class="code-number">3.65e5</span>) < <span class="code-number">1e-10</span></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- Videos -->
      <section class="section" id="videos">
        <div class="section-header">
          <div class="section-number">Section 6</div>
          <h2 class="section-title">Video Lessons</h2>
        </div>
        <div class="section-body">
          <p>
            Curated explanations from top educators. Click any video to watch. Each one covers a specific topic 
            in depth—use them to reinforce concepts you're unsure about.
          </p>

          <div class="video-container">
            <div class="video-player">
              <iframe id="ytPlayer" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
              <div class="video-info">
                <div class="video-title" id="videoTitle">Select a video to start</div>
                <div class="video-meta" id="videoMeta"></div>
              </div>
            </div>

            <div class="video-list" id="videoList"></div>
          </div>
        </div>
      </section>

      <!-- Practice -->
      <section class="section" id="practice">
        <div class="section-header">
          <div class="section-number">Section 7</div>
          <h2 class="section-title">Practice Problems</h2>
        </div>
        <div class="section-body">
          <p>
            Type your answer and press Check (or hit Enter). Accepted formats: 
            <span class="math-inline">5/6</span>, <span class="math-inline">1 7/8</span> (mixed), 
            <span class="math-inline">1.2e8</span>, <span class="math-inline">1.2*10^8</span>.
          </p>

          <div class="quiz-controls">
            <button class="btn btn-primary" id="btnCheckAll">Check All</button>
            <button class="btn" id="btnRevealAll">Reveal All</button>
            <button class="btn" id="btnClear">Clear Inputs</button>
            <button class="btn btn-danger" id="btnReset">Reset Stats</button>
          </div>

          <div id="quizContainer"></div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ==================== UTILITIES ====================
    function gcd(a, b) {
      a = Math.abs(a);
      b = Math.abs(b);
      while (b !== 0) {
        const t = a % b;
        a = b;
        b = t;
      }
      return a;
    }

    function reduceFrac(n, d) {
      if (d === 0) return { n: NaN, d: NaN };
      if (d < 0) { n = -n; d = -d; }
      const g = gcd(n, d);
      return { n: n / g, d: d / g };
    }

    function normalizeInput(s) {
      if (!s) return "";
      return s.trim()
        .replace(/\u2212/g, "-")
        .replace(/\s+/g, " ")
        .replace(/×/g, "*")
        .replace(/X/g, "*")
        .replace(/,/g, "");
    }

    function parseFrac(str) {
      const m = str.match(/^([+-]?\d+)\s*\/\s*([+-]?\d+)$/);
      if (!m) return null;
      const n = parseInt(m[1], 10);
      const d = parseInt(m[2], 10);
      if (d === 0) return null;
      return reduceFrac(n, d);
    }

    function parseMixed(str) {
      const m = str.match(/^([+-]?\d+)\s+(\d+)\s*\/\s*(\d+)$/);
      if (!m) return null;
      const whole = parseInt(m[1], 10);
      const n = parseInt(m[2], 10);
      const d = parseInt(m[3], 10);
      if (d === 0) return null;
      const sign = whole < 0 ? -1 : 1;
      const absWhole = Math.abs(whole);
      const totalN = sign * (absWhole * d + n);
      return reduceFrac(totalN, d);
    }

    function parseScientific(str) {
      const e = str.match(/^([+-]?\d+(?:\.\d+)?)\s*e\s*([+-]?\d+)$/i);
      if (e) return parseFloat(e[1]) * Math.pow(10, parseInt(e[2], 10));
      const t = str.match(/^([+-]?\d+(?:\.\d+)?)\s*\*\s*10\s*\^\s*\(?([+-]?\d+)\)?$/i);
      if (t) return parseFloat(t[1]) * Math.pow(10, parseInt(t[2], 10));
      return null;
    }

    function parseNumber(str) {
      const s = normalizeInput(str).toLowerCase();
      if (!s) return null;
      const mixed = parseMixed(s);
      if (mixed) return { kind: "fraction", frac: mixed, value: mixed.n / mixed.d };
      const frac = parseFrac(s);
      if (frac) return { kind: "fraction", frac: frac, value: frac.n / frac.d };
      const sci = parseScientific(s);
      if (sci !== null && !Number.isNaN(sci)) return { kind: "number", value: sci };
      const num = Number(s);
      if (!Number.isFinite(num)) return null;
      return { kind: "number", value: num };
    }

    function nearlyEqual(a, b, eps = 1e-10) {
      const scale = Math.max(1, Math.abs(a), Math.abs(b));
      return Math.abs(a - b) <= eps * scale;
    }

    // ==================== QUIZ DATA ====================
    const QUESTIONS = [
      { id: 1, topic: "Fractions", prompt: "Simplify: 42/56", exactFraction: { n: 3, d: 4 } },
      { id: 2, topic: "Fractions", prompt: "3/4 + 5/6", exactFraction: { n: 19, d: 12 } },
      { id: 3, topic: "Fractions", prompt: "7/9 − 1/6", exactFraction: { n: 11, d: 18 } },
      { id: 4, topic: "Fractions", prompt: "(5/12) × (18/25)", exactFraction: { n: 3, d: 10 } },
      { id: 5, topic: "Fractions", prompt: "(3/5) ÷ (9/10)", exactFraction: { n: 2, d: 3 } },
      { id: 6, topic: "Negatives", prompt: "−7 + 12", exactNumber: 5 },
      { id: 7, topic: "Negatives", prompt: "5 − (−13)", exactNumber: 18 },
      { id: 8, topic: "Negatives", prompt: "−4 − 9", exactNumber: -13 },
      { id: 9, topic: "Negatives", prompt: "(−6) × 7", exactNumber: -42 },
      { id: 10, topic: "Negatives", prompt: "(−48) ÷ (−6)", exactNumber: 8 },
      { id: 11, topic: "Exponents", prompt: "2⁶", exactNumber: 64 },
      { id: 12, topic: "Exponents", prompt: "5⁷ ÷ 5³", exactNumber: 625 },
      { id: 13, topic: "Exponents", prompt: "(3²)⁴", exactNumber: 6561 },
      { id: 14, topic: "Exponents", prompt: "16^(3/4)", exactNumber: 8 },
      { id: 15, topic: "Exponents", prompt: "∛(−125)", exactNumber: -5 },
      { id: 16, topic: "Scientific", prompt: "Write 0.000091 in scientific notation", acceptedStrings: ["9.1e-5", "9.1*10^-5", "9.1*10^(-5)"], exactNumber: 0.000091 },
      { id: 17, topic: "Scientific", prompt: "(6×10⁴) × (3×10⁻²)", acceptedStrings: ["1.8e3", "1.8*10^3", "1800"], exactNumber: 1800 },
      { id: 18, topic: "Scientific", prompt: "(9×10⁷) ÷ (3×10³)", acceptedStrings: ["3e4", "3*10^4", "30000"], exactNumber: 30000 },
      { id: 19, topic: "Scientific", prompt: "4.2×10⁵ + 7.9×10⁴", acceptedStrings: ["4.99e5", "4.99*10^5", "499000"], exactNumber: 499000 },
      { id: 20, topic: "Scientific", prompt: "Write 5.06×10⁻³ as decimal", acceptedStrings: ["0.00506"], exactNumber: 0.00506 },
    ];

    function expectedText(q) {
      if (q.exactFraction) {
        const f = reduceFrac(q.exactFraction.n, q.exactFraction.d);
        return `${f.n}/${f.d}`;
      }
      if (typeof q.exactNumber === "number") return String(q.exactNumber);
      return q.acceptedStrings?.[0] ?? "";
    }

    function isCorrect(q, userStr) {
      const uNorm = normalizeInput(userStr).toLowerCase();
      if (!uNorm) return { ok: false, reason: "empty" };
      if (q.acceptedStrings && q.acceptedStrings.some(s => normalizeInput(s).toLowerCase() === uNorm)) {
        return { ok: true, reason: "string" };
      }
      const parsed = parseNumber(uNorm);
      if (!parsed) return { ok: false, reason: "parse" };
      if (q.exactFraction) {
        const ex = reduceFrac(q.exactFraction.n, q.exactFraction.d);
        if (parsed.kind === "fraction") {
          return { ok: parsed.frac.n === ex.n && parsed.frac.d === ex.d, reason: "fraction" };
        }
        return { ok: nearlyEqual(parsed.value, ex.n / ex.d), reason: "numeric" };
      }
      if (typeof q.exactNumber === "number") {
        return { ok: nearlyEqual(parsed.value, q.exactNumber), reason: "numeric" };
      }
      return { ok: false, reason: "unknown" };
    }

    // ==================== STATE ====================
    const LS_KEY = "arith_fluency_cs_v1";
    let stats = loadStats();
    let sessionCorrect = 0;
    let sessionAttempted = 0;

    function loadStats() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return { attempted: 0, correct: 0 };
        return JSON.parse(raw);
      } catch {
        return { attempted: 0, correct: 0 };
      }
    }

    function saveStats() {
      localStorage.setItem(LS_KEY, JSON.stringify(stats));
    }

    function updateStatsUI() {
      document.getElementById("statAttempted").textContent = stats.attempted;
      document.getElementById("statCorrect").textContent = stats.correct;
      document.getElementById("statAccuracy").textContent = stats.attempted > 0 
        ? `${Math.round((stats.correct / stats.attempted) * 100)}%` 
        : "—";
      
      const pct = QUESTIONS.length > 0 ? Math.round((sessionCorrect / QUESTIONS.length) * 100) : 0;
      document.getElementById("progressText").textContent = `${sessionCorrect} / ${QUESTIONS.length} complete`;
      document.getElementById("progressFill").style.width = `${pct}%`;
    }

    // ==================== QUIZ UI ====================
    function renderQuiz() {
      const container = document.getElementById("quizContainer");
      container.innerHTML = "";

      QUESTIONS.forEach(q => {
        const div = document.createElement("div");
        div.className = "question";
        div.dataset.qid = q.id;
        div.innerHTML = `
          <div class="question-header">
            <span class="question-num">Q${q.id}</span>
            <span class="question-topic">${q.topic}</span>
          </div>
          <div class="question-prompt">${q.prompt}</div>
          <div class="question-input-row">
            <input type="text" class="question-input" placeholder="Your answer..." />
            <button class="btn btn-primary btn-check">Check</button>
            <button class="btn btn-show">Show</button>
          </div>
          <div class="question-result"></div>
        `;

        const input = div.querySelector(".question-input");
        const result = div.querySelector(".question-result");
        const btnCheck = div.querySelector(".btn-check");
        const btnShow = div.querySelector(".btn-show");

        btnCheck.addEventListener("click", () => checkQuestion(q, input, result));
        input.addEventListener("keydown", e => {
          if (e.key === "Enter") checkQuestion(q, input, result);
        });
        btnShow.addEventListener("click", () => {
          result.innerHTML = `<div class="question-answer">Answer: ${expectedText(q)}</div>`;
        });

        container.appendChild(div);
      });
    }

    function checkQuestion(q, input, resultEl) {
      const verdict = isCorrect(q, input.value);
      stats.attempted++;
      sessionAttempted++;

      if (verdict.ok) {
        stats.correct++;
        sessionCorrect++;
        input.classList.remove("incorrect");
        input.classList.add("correct");
        resultEl.innerHTML = `<span class="success">✓ Correct</span>`;
      } else {
        input.classList.remove("correct");
        input.classList.add("incorrect");
        const msg = verdict.reason === "empty" ? "Enter an answer first" 
          : verdict.reason === "parse" ? "Couldn't parse that format"
          : "Not quite right";
        resultEl.innerHTML = `<span class="error">✗ ${msg}</span>`;
      }

      saveStats();
      updateStatsUI();
    }

    // Controls
    document.getElementById("btnCheckAll").addEventListener("click", () => {
      document.querySelectorAll(".question").forEach(div => {
        div.querySelector(".btn-check").click();
      });
    });

    document.getElementById("btnRevealAll").addEventListener("click", () => {
      document.querySelectorAll(".question").forEach(div => {
        div.querySelector(".btn-show").click();
      });
    });

    document.getElementById("btnClear").addEventListener("click", () => {
      document.querySelectorAll(".question").forEach(div => {
        const input = div.querySelector(".question-input");
        input.value = "";
        input.classList.remove("correct", "incorrect");
        div.querySelector(".question-result").innerHTML = "";
      });
      sessionCorrect = 0;
      sessionAttempted = 0;
      updateStatsUI();
    });

    document.getElementById("btnReset").addEventListener("click", () => {
      if (!confirm("Reset all saved stats? This cannot be undone.")) return;
      stats = { attempted: 0, correct: 0 };
      saveStats();
      sessionCorrect = 0;
      sessionAttempted = 0;
      updateStatsUI();
    });

    // ==================== VIDEO PLAYER ====================
    const VIDEO_GROUPS = [
      {
        title: "Fractions",
        items: [
          { title: "Khan Academy — Fraction Basics", channel: "Khan Academy", vid: "kZzoVCmUyKg" },
          { title: "Math Antics — Fractions Are Parts", channel: "Math Antics", vid: "CA9XLJpQp3c" },
          { title: "Math Antics — Adding & Subtracting", channel: "Math Antics", vid: "5juto2ze8Lg" },
        ]
      },
      {
        title: "Negatives",
        items: [
          { title: "Khan Academy — Negative Numbers Intro", channel: "Khan Academy", vid: "u8UKdNdpkh4" },
          { title: "Khan Academy — Adding/Subtracting Examples", channel: "Khan Academy", vid: "Hlal9ME2Aig" },
          { title: "Organic Chem Tutor — All Operations", channel: "Organic Chem Tutor", vid: "CF7CPU8Ieyo" },
        ]
      },
      {
        title: "Exponents & Roots",
        items: [
          { title: "Khan Academy — Exponent Rules", channel: "Khan Academy", vid: "kITJ6qH7jS0" },
          { title: "PatrickJMT — Exponent Examples", channel: "PatrickJMT", vid: "wsaH5CARIHI" },
          { title: "Khan Academy — Simplifying Radicals", channel: "Khan Academy", vid: "6QJtWfIiyZo" },
        ]
      },
      {
        title: "Scientific Notation",
        items: [
          { title: "Khan Academy — Scientific Notation", channel: "Khan Academy", vid: "i6lfVUp5RW8" },
          { title: "Organic Chem Tutor — Intro + Operations", channel: "Organic Chem Tutor", vid: "_BtzXojuM1o" },
          { title: "Khan Academy — Multiply/Divide", channel: "Khan Academy", vid: "mWj4nV9sHqY" },
        ]
      }
    ];

    function renderVideoList() {
      const container = document.getElementById("videoList");
      container.innerHTML = "";
      let idx = 0;

      VIDEO_GROUPS.forEach(group => {
        const titleDiv = document.createElement("div");
        titleDiv.className = "video-group-title";
        titleDiv.textContent = group.title;
        container.appendChild(titleDiv);

        group.items.forEach(item => {
          idx++;
          const btn = document.createElement("button");
          btn.className = "video-item";
          btn.dataset.vid = item.vid;
          btn.innerHTML = `
            <span class="video-num">${idx}</span>
            <div>
              <div class="video-item-title">${item.title}</div>
              <div class="video-item-desc">${item.channel}</div>
            </div>
          `;
          btn.addEventListener("click", () => setVideo(item, btn));
          container.appendChild(btn);
        });
      });

      // Load first video
      const first = VIDEO_GROUPS[0].items[0];
      const firstBtn = container.querySelector(".video-item");
      setVideo(first, firstBtn);
    }

    function setVideo(item, btn) {
      document.querySelectorAll(".video-item").forEach(b => b.classList.remove("active"));
      if (btn) btn.classList.add("active");
      document.getElementById("ytPlayer").src = `https://www.youtube.com/embed/${item.vid}?rel=0`;
      document.getElementById("videoTitle").textContent = item.title;
      document.getElementById("videoMeta").textContent = item.channel;
    }

    // ==================== TOC HIGHLIGHTING ====================
    const tocLinks = document.querySelectorAll(".toc-link");
    const sections = document.querySelectorAll(".section");

    function updateTocHighlight() {
      let current = "";
      sections.forEach(section => {
        const top = section.getBoundingClientRect().top;
        if (top < 150) current = section.id;
      });
      tocLinks.forEach(link => {
        link.classList.toggle("active", link.getAttribute("href") === `#${current}`);
      });
    }

    window.addEventListener("scroll", updateTocHighlight);

    // ==================== INIT ====================
    renderQuiz();
    renderVideoList();
    updateStatsUI();
    updateTocHighlight();
  </script>
</body>
</html>
